<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–±—Å—É—Ä–¥–Ω—ã–µ —à–∞—Ö–º–∞—Ç—ã –æ–Ω–ª–∞–π–Ω</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        
        body {
            background: linear-gradient(45deg, #ff00ff, #00ffff, #ffff00);
            min-height: 100vh;
            padding: 10px;
            animation: backgroundShift 10s infinite alternate;
        }
        
        @keyframes backgroundShift {
            0% { background: linear-gradient(45deg, #ff00ff, #00ffff); }
            50% { background: linear-gradient(45deg, #ffff00, #ff00ff); }
            100% { background: linear-gradient(45deg, #00ffff, #ffff00); }
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 0 50px rgba(0,0,0,0.3);
            border: 5px dashed #ff00ff;
        }
        
        h1 {
            text-align: center;
            color: #ff00ff;
            font-size: 2rem;
            text-shadow: 3px 3px 0 #00ffff;
            margin-bottom: 10px;
            animation: titlePulse 2s infinite;
        }
        
        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .room-controls {
            background: #ffff00;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            border: 3px dotted #ff00ff;
        }
        
        .input-group {
            margin-bottom: 10px;
        }
        
        input, select, button {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border-radius: 10px;
            border: 3px solid #00ffff;
            font-size: 16px;
            background: white;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, button:focus {
            outline: none;
            border-color: #ff00ff;
            transform: scale(1.05);
        }
        
        button {
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            color: white;
            font-weight: bold;
            cursor: pointer;
            border: none;
        }
        
        button:hover {
            background: linear-gradient(45deg, #ffff00, #ff00ff);
            transform: rotate(2deg) scale(1.05);
        }
        
        .game-info {
            background: #00ffff;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            border: 3px solid #ffff00;
        }
        
        #status {
            font-weight: bold;
            color: #ff00ff;
            font-size: 1.2rem;
        }
        
        #chessboard {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            width: 100%;
            aspect-ratio: 1 / 1;
            gap: 2px;
            background: black;
            border: 5px solid #ff00ff;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .square {
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .square:nth-child(odd) {
            background: #ffff00;
        }
        
        .square:nth-child(even) {
            background: #00ffff;
        }
        
        .square:hover {
            transform: scale(1.1);
            z-index: 2;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        .selected {
            background: #ff00ff !important;
            color: white;
        }
        
        .possible {
            background: rgba(255, 0, 255, 0.3) !important;
        }
        
        .capture {
            background: rgba(255, 255, 0, 0.5) !important;
        }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .player {
            background: rgba(255, 255, 255, 0.9);
            padding: 8px;
            border-radius: 10px;
            width: 48%;
            text-align: center;
            border: 2px solid;
        }
        
        #white-player {
            border-color: #ffff00;
            background: rgba(255, 255, 0, 0.2);
        }
        
        #black-player {
            border-color: #00ffff;
            background: rgba(0, 255, 255, 0.2);
        }
        
        .chat-box {
            margin-top: 15px;
            background: white;
            border-radius: 10px;
            padding: 10px;
            border: 3px solid #ff00ff;
        }
        
        #chat-messages {
            height: 100px;
            overflow-y: auto;
            margin-bottom: 10px;
            padding: 5px;
            background: #f0f0f0;
            border-radius: 5px;
        }
        
        .chat-input {
            display: flex;
            gap: 5px;
        }
        
        .chat-input input {
            flex: 1;
        }
        
        .chat-input button {
            width: auto;
            padding: 10px 15px;
        }
        
        .message {
            padding: 3px;
            border-bottom: 1px dotted #ccc;
        }
        
        .online-count {
            text-align: center;
            color: #ff00ff;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .crazy-mode {
            text-align: center;
            margin: 10px 0;
        }
        
        #crazy-button {
            background: linear-gradient(45deg, red, orange, yellow, green, blue, purple);
            color: white;
            animation: rainbow 3s infinite linear;
        }
        
        @keyframes rainbow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
        
        .rules {
            margin-top: 15px;
            background: rgba(0, 255, 255, 0.2);
            padding: 10px;
            border-radius: 10px;
            font-size: 0.9rem;
        }
        
        .rules h3 {
            color: #ff00ff;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§™ –ê–ë–°–£–†–î–ù–´–ï –®–ê–•–ú–ê–¢–´ ü§™</h1>
        
        <div class="room-controls">
            <div class="input-group">
                <input type="text" id="username" placeholder="–¢–≤–æ–µ –±–µ–∑—É–º–Ω–æ–µ –∏–º—è" value="–ë–µ–∑—É–º–µ—Ü_" maxlength="15">
            </div>
            <div class="input-group">
                <select id="room-select">
                    <option value="random">üé≤ –°–ª—É—á–∞–π–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞</option>
                    <option value="chaos">üåÄ –ö–æ–º–Ω–∞—Ç–∞ –•–∞–æ—Å–∞</option>
                    <option value="rainbow">üåà –†–∞–¥—É–∂–Ω–∞—è –±–∏—Ç–≤–∞</option>
                    <option value="create">‚ûï –°–æ–∑–¥–∞—Ç—å —Å–≤–æ—é</option>
                </select>
            </div>
            <button id="join-btn">üöÄ –í–†–£–ë–ò–¢–¨ –ë–ï–ó–£–ú–ò–ï!</button>
        </div>
        
        <div class="game-info">
            <div id="status">–í—Ö–æ–¥–∏ –≤ –∫–æ–º–Ω–∞—Ç—É –±–µ–∑—É–º–∏—è!</div>
            <div class="online-count">üë• –û–Ω–ª–∞–π–Ω: <span id="online-count">0</span> –±–µ–∑—É–º—Ü–µ–≤</div>
        </div>
        
        <div class="crazy-mode">
            <button id="crazy-button">üåÄ –í–ö–õ–Æ–ß–ò–¢–¨ –°–£–ü–ï–†-–•–ê–û–°</button>
        </div>
        
        <div id="chessboard"></div>
        
        <div class="player-info">
            <div class="player" id="white-player">
                <div>ü§ç –ë–ï–õ–´–ï</div>
                <div id="white-name">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
            </div>
            <div class="player" id="black-player">
                <div>üñ§ –ß–ï–†–ù–´–ï</div>
                <div id="black-name">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
            </div>
        </div>
        
        <div class="chat-box">
            <div id="chat-messages"></div>
            <div class="chat-input">
                <input type="text" id="chat-input" placeholder="–ü–∏—à–∏ –±–µ–∑—É–º–∏–µ..." maxlength="100">
                <button id="send-btn">üí¨</button>
            </div>
        </div>
        
        <div class="rules">
            <h3>üìú –ü–†–ê–í–ò–õ–ê –ë–ï–ó–£–ú–ò–Ø:</h3>
            <p>1. –í—Å–µ —Ñ–∏–≥—É—Ä—ã —Ö–æ–¥—è—Ç –°–õ–£–ß–ê–ô–ù–û</p>
            <p>2. –ö–∞–∂–¥—ã–π —Ö–æ–¥ - —Å—é—Ä–ø—Ä–∏–∑!</p>
            <p>3. –ü–æ–±–µ–∂–¥–∞–µ—Ç —Ç–æ—Ç, –∫—Ç–æ –≤—ã–∂–∏–≤–µ—Ç –≤ —Ö–∞–æ—Å–µ!</p>
        </div>
    </div>

    <script>
        // –†–µ–∞–ª—å–Ω—ã–µ –æ–Ω–ª–∞–π–Ω-—à–∞—Ö–º–∞—Ç—ã —Å –∞–±—Å—É—Ä–¥–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏
        const socket = new WebSocket('wss://chess-websocket-server.glitch.me/');
        
        let gameState = {
            board: [],
            color: null,
            room: null,
            players: {},
            turn: 'white',
            selected: null,
            username: '',
            crazyMode: false
        };
        
        // –ê–ë–°–£–†–î–ù–´–ï –§–ò–ì–£–†–´
        const CRAZY_PIECES = {
            // –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã —Å –∏–∑—é–º–∏–Ω–∫–æ–π
            'wr': { char: 'ü§°', name: '–ö–ª–æ—É–Ω' },      // –õ–∞–¥—å—è
            'wn': { char: 'ü¶Ñ', name: '–ï–¥–∏–Ω–æ—Ä–æ–≥' },    // –ö–æ–Ω—å
            'wb': { char: 'üëΩ', name: '–ü—Ä–∏—à–µ–ª–µ—Ü' },    // –°–ª–æ–Ω
            'wq': { char: 'üëë', name: '–ö–æ—Ä–æ–ª–µ–≤–∞ –•–∞–æ—Å–∞' }, // –§–µ—Ä–∑—å
            'wk': { char: 'üëæ', name: '–ö–æ—Ä–æ–ª—å –ë–µ–∑—É–º–∏—è' }, // –ö–æ—Ä–æ–ª—å
            'wp': { char: 'üê∏', name: '–õ—è–≥—É—à–∫–∞' },     // –ü–µ—à–∫–∞
            
            'br': { char: 'ü§ñ', name: '–†–æ–±–æ—Ç' },
            'bn': { char: 'üêâ', name: '–î—Ä–∞–∫–æ–Ω' },
            'bb': { char: 'ü¶π', name: '–ó–ª–æ–¥–µ–π' },
            'bq': { char: 'üßô', name: '–í–æ–ª—à–µ–±–Ω–∏–∫' },
            'bk': { char: 'üßü', name: '–ó–æ–º–±–∏' },
            'bp': { char: 'üêô', name: '–û—Å—å–º–∏–Ω–æ–≥' }
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å–∫–∏
        function initBoard() {
            const board = [];
            for (let i = 0; i < 8; i++) {
                board[i] = new Array(8).fill('');
            }
            
            // –†–∞—Å—Å—Ç–∞–≤–ª—è–µ–º –∞–±—Å—É—Ä–¥–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ!
            const pieces = ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'];
            const crazyPieces = ['ü§°', 'ü¶Ñ', 'üëΩ', 'üëë', 'üëæ', 'ü¶π', 'üêâ', 'üßô'];
            
            // –ë–µ–ª—ã–µ —Ñ–∏–≥—É—Ä—ã (—Å–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫!)
            const shuffledWhite = [...crazyPieces].sort(() => Math.random() - 0.5);
            for (let i = 0; i < 8; i++) {
                board[7][i] = 'w' + pieces[i];
                board[6][i] = 'wp';
            }
            
            // –ß–µ—Ä–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã (—Ç–æ–∂–µ —Å–ª—É—á–∞–π–Ω–æ!)
            const shuffledBlack = [...crazyPieces].sort(() => Math.random() - 0.5);
            for (let i = 0; i < 8; i++) {
                board[0][i] = 'b' + pieces[i];
                board[1][i] = 'bp';
            }
            
            // –ò–Ω–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã –Ω–∞ –ø—É—Å—Ç—ã–µ –∫–ª–µ—Ç–∫–∏
            if (Math.random() > 0.5) {
                const extraPieces = ['üê≤', 'üëª', 'ü¶∏', 'üßõ', 'ü¶ö', 'ü¶ä'];
                for (let i = 2; i < 6; i++) {
                    for (let j = 0; j < 8; j++) {
                        if (Math.random() > 0.7) {
                            const color = Math.random() > 0.5 ? 'w' : 'b';
                            const randomPiece = extraPieces[Math.floor(Math.random() * extraPieces.length)];
                            // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è —Å–ª—É—á–∞–π–Ω–æ–π —Ñ–∏–≥—É—Ä—ã
                            board[i][j] = color + 'x' + randomPiece.charCodeAt(0);
                        }
                    }
                }
            }
            
            gameState.board = board;
            renderBoard();
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–æ—Å–∫–∏
        function renderBoard() {
            const boardElement = document.getElementById('chessboard');
            boardElement.innerHTML = '';
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = 'square';
                    square.dataset.row = row;
                    square.dataset.col = col;
                    
                    const piece = gameState.board[row][col];
                    if (piece) {
                        const pieceInfo = getPieceInfo(piece);
                        square.textContent = pieceInfo.char;
                        square.title = pieceInfo.name;
                    }
                    
                    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–ª–µ—Ç–∫–∏
                    if (gameState.selected && 
                        gameState.selected.row === row && 
                        gameState.selected.col === col) {
                        square.classList.add('selected');
                    }
                    
                    square.addEventListener('click', () => handleSquareClick(row, col));
                    boardElement.appendChild(square);
                }
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∏–≥—É—Ä–µ
        function getPieceInfo(pieceCode) {
            if (pieceCode.includes('x')) {
                // –°–ª—É—á–∞–π–Ω–∞—è —Ñ–∏–≥—É—Ä–∞
                const color = pieceCode[0];
                const charCode = pieceCode.substring(2);
                const char = String.fromCharCode(charCode);
                return { char, name: '–°–µ–∫—Ä–µ—Ç–Ω–∞—è —Ñ–∏–≥—É—Ä–∞' };
            }
            return CRAZY_PIECES[pieceCode] || { char: '‚ùì', name: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' };
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–ª–µ—Ç–∫–µ
        function handleSquareClick(row, col) {
            const piece = gameState.board[row][col];
            
            if (!gameState.room || gameState.color !== gameState.turn) {
                showMessage('–ù–µ —Ç–≤–æ–π —Ö–æ–¥ –∏–ª–∏ –Ω–µ—Ç –∫–æ–º–Ω–∞—Ç—ã!');
                return;
            }
            
            // –ï—Å–ª–∏ —Ñ–∏–≥—É—Ä–∞ –≤—ã–±—Ä–∞–Ω–∞ –∏ —ç—Ç–æ —Ñ–∏–≥—É—Ä–∞ –∏–≥—Ä–æ–∫–∞
            if (piece && piece[0] === gameState.color[0]) {
                gameState.selected = { row, col };
                renderBoard();
                showPossibleMoves(row, col, piece);
            }
            // –ï—Å–ª–∏ –∫–ª–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–∞ –¥–ª—è —Ö–æ–¥–∞
            else if (gameState.selected) {
                makeMove(gameState.selected.row, gameState.selected.col, row, col);
                gameState.selected = null;
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã (–í–°–ï –ö–õ–ï–¢–ö–ò –í–û–ö–†–£–ì!)
        function showPossibleMoves(fromRow, fromCol, piece) {
            const squares = document.querySelectorAll('.square');
            
            // –í –ê–ë–°–£–†–î–ù–´–• –®–ê–•–ú–ê–¢–ê–• –ú–û–ñ–ù–û –•–û–î–ò–¢–¨ –ö–£–î–ê –£–ì–û–î–ù–û!
            // –ù–æ —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –¥–ª—è "–±–∞–ª–∞–Ω—Å–∞"
            
            squares.forEach(square => {
                const row = parseInt(square.dataset.row);
                const col = parseInt(square.dataset.col);
                
                // –ú–æ–∂–Ω–æ —Ö–æ–¥–∏—Ç—å –Ω–∞ –ª—é–±—É—é –∫–ª–µ—Ç–∫—É –≤ —Ä–∞–¥–∏—É—Å–µ 3 –∫–ª–µ—Ç–æ–∫
                const rowDiff = Math.abs(row - fromRow);
                const colDiff = Math.abs(col - fromCol);
                
                if ((rowDiff <= 3 && colDiff <= 3) && !(row === fromRow && col === fromCol)) {
                    const targetPiece = gameState.board[row][col];
                    
                    if (targetPiece && targetPiece[0] !== piece[0]) {
                        square.classList.add('capture');
                    } else if (!targetPiece) {
                        square.classList.add('possible');
                    }
                }
            });
        }
        
        // –°–¥–µ–ª–∞—Ç—å —Ö–æ–¥
        function makeMove(fromRow, fromCol, toRow, toCol) {
            const piece = gameState.board[fromRow][fromCol];
            const targetPiece = gameState.board[toRow][toCol];
            
            // –í –ê–ë–°–£–†–î–ù–´–• –®–ê–•–ú–ê–¢–ê–•:
            // 1. –§–∏–≥—É—Ä–∞ –∏–Ω–æ–≥–¥–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤–æ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ
            // 2. –ò–Ω–æ–≥–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è —Ñ–∏–≥—É—Ä–∞
            // 3. –ò–Ω–æ–≥–¥–∞ —Ñ–∏–≥—É—Ä–∞ –∏—Å—á–µ–∑–∞–µ—Ç
            
            let newPiece = piece;
            const randomEvent = Math.random();
            
            if (randomEvent < 0.1) {
                // –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ!
                const crazyPieces = Object.keys(CRAZY_PIECES);
                const randomCrazy = crazyPieces[Math.floor(Math.random() * crazyPieces.length)];
                newPiece = piece[0] + randomCrazy[1];
                showMessage('üåÄ –§–ò–ì–£–†–ê –ü–†–ï–í–†–ê–¢–ò–õ–ê–°–¨!');
            } else if (randomEvent < 0.15) {
                // –ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ!
                newPiece = '';
                showMessage('üí• –§–ò–ì–£–†–ê –ò–°–ß–ï–ó–õ–ê!');
            } else if (randomEvent < 0.2 && !targetPiece) {
                // –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–æ–Ω–∞!
                gameState.board[fromRow][fromCol] = piece; // –û—Ä–∏–≥–∏–Ω–∞–ª –æ—Å—Ç–∞–µ—Ç—Å—è
                newPiece = piece;
                showMessage('üëØ –ü–û–Ø–í–ò–õ–°–Ø –ö–õ–û–ù!');
            }
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º —Ö–æ–¥
            gameState.board[toRow][toCol] = newPiece;
            
            // –í 50% —Å–ª—É—á–∞–µ–≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Ñ–∏–≥—É—Ä–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ (—Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è!)
            if (Math.random() > 0.5) {
                gameState.board[fromRow][fromCol] = '';
            }
            
            // –ò–Ω–æ–≥–¥–∞ —Å–æ–∑–¥–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Ñ–∏–≥—É—Ä—É –Ω–∞ –ø—É—Å—Ç–æ–π –∫–ª–µ—Ç–∫–µ
            if (Math.random() > 0.7) {
                const emptyCells = [];
                for (let i = 0; i < 8; i++) {
                    for (let j = 0; j < 8; j++) {
                        if (!gameState.board[i][j]) {
                            emptyCells.push({row: i, col: j});
                        }
                    }
                }
                
                if (emptyCells.length > 0) {
                    const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                    const randomPieceType = ['r', 'n', 'b', 'q', 'p'][Math.floor(Math.random() * 5)];
                    const randomColor = Math.random() > 0.5 ? 'w' : 'b';
                    gameState.board[randomCell.row][randomCell.col] = randomColor + randomPieceType;
                    showMessage('‚ú® –ü–û–Ø–í–ò–õ–ê–°–Ø –°–õ–£–ß–ê–ô–ù–ê–Ø –§–ò–ì–£–†–ê!');
                }
            }
            
            // –ú–µ–Ω—è–µ–º —Ö–æ–¥
            gameState.turn = gameState.turn === 'white' ? 'black' : 'white';
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ö–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            if (socket.readyState === WebSocket.OPEN) {
                const move = {
                    type: 'move',
                    room: gameState.room,
                    from: {row: fromRow, col: fromCol},
                    to: {row: toRow, col: toCol},
                    piece: piece,
                    crazyMode: gameState.crazyMode
                };
                socket.send(JSON.stringify(move));
            }
            
            renderBoard();
            updateStatus();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ "–º–∞—Ç" (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –ø—Ä–æ—Å—Ç–æ —Ä–∞–Ω–¥–æ–º)
            if (Math.random() > 0.95) {
                setTimeout(() => {
                    alert('üéâ –°–õ–£–ß–ê–ô–ù–ê–Ø –ü–û–ë–ï–î–ê! –ò–≥—Ä–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è!');
                    initBoard();
                }, 500);
            }
        }
        
        // WebSocket –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        socket.onopen = function() {
            console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É –±–µ–∑—É–º–∏—è!');
            updateOnlineCount();
        };
        
        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            
            switch(data.type) {
                case 'online_count':
                    document.getElementById('online-count').textContent = data.count;
                    break;
                    
                case 'join_room':
                    gameState.room = data.room;
                    gameState.color = data.color;
                    gameState.players = data.players;
                    
                    document.getElementById('white-name').textContent = 
                        data.players.white || '–û–∂–∏–¥–∞–Ω–∏–µ...';
                    document.getElementById('black-name').textContent = 
                        data.players.black || '–û–∂–∏–¥–∞–Ω–∏–µ...';
                    
                    if (data.board) {
                        gameState.board = data.board;
                    } else {
                        initBoard();
                    }
                    
                    updateStatus();
                    showMessage(`üé™ –í–æ—à–ª–∏ –≤ –∫–æ–º–Ω–∞—Ç—É: ${data.room}`);
                    break;
                    
                case 'player_joined':
                    gameState.players[data.color] = data.username;
                    document.getElementById(`${data.color}-name`).textContent = data.username;
                    showMessage(`üëã ${data.username} –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫–∞–∫ ${data.color === 'white' ? '–±–µ–ª—ã–µ' : '—á–µ—Ä–Ω—ã–µ'}`);
                    break;
                    
                case 'move':
                    // –ü–æ–ª—É—á–∞–µ–º —Ö–æ–¥ –æ—Ç –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
                    gameState.board[data.to.row][data.to.col] = data.piece;
                    gameState.board[data.from.row][data.from.col] = '';
                    gameState.turn = gameState.color;
                    
                    // –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω —Ä–µ–∂–∏–º –±–µ–∑—É–º–∏—è, –¥–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏
                    if (gameState.crazyMode) {
                        setTimeout(addRandomChaos, 300);
                    }
                    
                    renderBoard();
                    updateStatus();
                    showMessage(`‚ôüÔ∏è –°–æ–ø–µ—Ä–Ω–∏–∫ —Å–¥–µ–ª–∞–ª —Ö–æ–¥`);
                    break;
                    
                case 'chat':
                    addChatMessage(data.username, data.message);
                    break;
                    
                case 'error':
                    showMessage(`‚ùå –û—à–∏–±–∫–∞: ${data.message}`);
                    break;
            }
        };
        
        // –î–æ–±–∞–≤–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π —Ö–∞–æ—Å –Ω–∞ –¥–æ—Å–∫—É
        function addRandomChaos() {
            const chaosTypes = [
                () => { // –°–ª—É—á–∞–π–Ω—ã–µ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏
                    const pieces = [];
                    for (let i = 0; i < 8; i++) {
                        for (let j = 0; j < 8; j++) {
                            if (gameState.board[i][j]) {
                                pieces.push({piece: gameState.board[i][j], row: i, col: j});
                            }
                        }
                    }
                    
                    if (pieces.length > 1) {
                        const p1 = pieces[Math.floor(Math.random() * pieces.length)];
                        const p2 = pieces[Math.floor(Math.random() * pieces.length)];
                        
                        [gameState.board[p1.row][p1.col], gameState.board[p2.row][p2.col]] = 
                        [gameState.board[p2.row][p2.col], gameState.board[p1.row][p1.col]];
                        
                        showMessage('üåÄ –¢–ï–õ–ï–ü–û–†–¢–ê–¶–ò–Ø –§–ò–ì–£–†!');
                        renderBoard();
                    }
                },
                () => { // –°–ª—É—á–∞–π–Ω–æ–µ –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ
                    const pieces = [];
                    for (let i = 0; i < 8; i++) {
                        for (let j = 0; j < 8; j++) {
                            if (gameState.board[i][j]) {
                                pieces.push({row: i, col: j});
                            }
                        }
                    }
                    
                    if (pieces.length > 0) {
                        const cell = pieces[Math.floor(Math.random() * pieces.length)];
                        const pieceTypes = ['r', 'n', 'b', 'q', 'p'];
                        const randomType = pieceTypes[Math.floor(Math.random() * pieceTypes.length)];
                        const color = gameState.board[cell.row][cell.col][0];
                        gameState.board[cell.row][cell.col] = color + randomType;
                        
                        showMessage('üîÆ –°–õ–£–ß–ê–ô–ù–û–ï –ü–†–ï–í–†–ê–©–ï–ù–ò–ï!');
                        renderBoard();
                    }
                },
                () => { // –ó–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–µ - –≤—Å–µ —Ñ–∏–≥—É—Ä—ã —Å–¥–≤–∏–≥–∞—é—Ç—Å—è
                    const newBoard = Array(8).fill().map(() => Array(8).fill(''));
                    
                    for (let i = 0; i < 8; i++) {
                        for (let j = 0; j < 8; j++) {
                            if (gameState.board[i][j]) {
                                const newRow = (i + Math.floor(Math.random() * 3) - 1 + 8) % 8;
                                const newCol = (j + Math.floor(Math.random() * 3) - 1 + 8) % 8;
                                newBoard[newRow][newCol] = gameState.board[i][j];
                            }
                        }
                    }
                    
                    gameState.board = newBoard;
                    showMessage('üåã –ó–ï–ú–õ–ï–¢–†–Ø–°–ï–ù–ò–ï –ù–ê –î–û–°–ö–ï!');
                    renderBoard();
                }
            ];
            
            const randomChaos = chaosTypes[Math.floor(Math.random() * chaosTypes.length)];
            randomChaos();
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
        function updateStatus() {
            let status = '';
            if (!gameState.room) {
                status = '–í—ã–±–µ—Ä–∏ –∫–æ–º–Ω–∞—Ç—É –±–µ–∑—É–º–∏—è!';
            } else if (!gameState.color) {
                status = '–û–∂–∏–¥–∞–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...';
            } else if (gameState.turn === gameState.color) {
                status = 'üéØ –¢–í–û–ô –•–û–î! –•–æ–¥–∏ –∫—É–¥–∞ —Ö–æ—á–µ—à—å!';
            } else {
                status = '‚è≥ –•–æ–¥ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...';
            }
            
            document.getElementById('status').textContent = status;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(msg) {
            document.getElementById('status').textContent = msg;
            setTimeout(updateStatus, 3000);
        }
        
        // –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        function addChatMessage(username, message) {
            const chat = document.getElementById('chat-messages');
            const msgDiv = document.createElement('div');
            msgDiv.className = 'message';
            msgDiv.innerHTML = `<strong>${username}:</strong> ${message}`;
            chat.appendChild(msgDiv);
            chat.scrollTop = chat.scrollHeight;
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–Ω–ª–∞–π–Ω
        function updateOnlineCount() {
            if (socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify({type: 'get_online_count'}));
            }
        }
        
        // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ
        function joinRoom() {
            const username = document.getElementById('username').value || '–ë–µ–∑—É–º–µ—Ü_' + Math.floor(Math.random() * 1000);
            const roomType = document.getElementById('room-select').value;
            
            let room;
            if (roomType === 'create') {
                room = 'room_' + Math.random().toString(36).substring(7);
            } else {
                room = roomType;
            }
            
            gameState.username = username;
            
            if (socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify({
                    type: 'join',
                    room: room,
                    username: username
                }));
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (message && gameState.room) {
                if (socket.readyState === WebSocket.OPEN) {
                    socket.send(JSON.stringify({
                        type: 'chat',
                        room: gameState.room,
                        message: message
                    }));
                }
                
                addChatMessage(gameState.username, message);
                input.value = '';
            }
        }
        
        // –í–∫–ª—é—á–∏—Ç—å —Å—É–ø–µ—Ä-—Ö–∞–æ—Å
        function toggleCrazyMode() {
            gameState.crazyMode = !gameState.crazyMode;
            const btn = document.getElementById('crazy-button');
            
            if (gameState.crazyMode) {
                btn.textContent = 'üåÄ –í–´–ö–õ–Æ–ß–ò–¢–¨ –°–£–ü–ï–†-–•–ê–û–°';
                btn.style.animation = 'rainbow 1s infinite linear';
                showMessage('üå™Ô∏è –†–ï–ñ–ò–ú –°–£–ü–ï–†-–•–ê–û–° –ê–ö–¢–ò–í–ò–†–û–í–ê–ù!');
                
                // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º —Ö–∞–æ—Å
                setInterval(() => {
                    if (gameState.crazyMode && gameState.room) {
                        addRandomChaos();
                    }
                }, 5000);
            } else {
                btn.textContent = 'üåÄ –í–ö–õ–Æ–ß–ò–¢–¨ –°–£–ü–ï–†-–•–ê–û–°';
                btn.style.animation = '';
                showMessage('–†–µ–∂–∏–º —Å—É–ø–µ—Ä-—Ö–∞–æ—Å –≤—ã–∫–ª—é—á–µ–Ω');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
        document.getElementById('join-btn').addEventListener('click', joinRoom);
        document.getElementById('send-btn').addEventListener('click', sendChatMessage);
        document.getElementById('crazy-button').addEventListener('click', toggleCrazyMode);
        
        document.getElementById('chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendChatMessage();
        });
        
        document.getElementById('username').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') joinRoom();
        });
        
        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–Ω–ª–∞–π–Ω
        setInterval(updateOnlineCount, 10000);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        initBoard();
        updateStatus();
        
        // –≠–º—É–ª—è—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –µ—Å–ª–∏ WebSocket –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
        setTimeout(() => {
            if (socket.readyState !== WebSocket.OPEN) {
                showMessage('‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (–±–µ–∑ –æ–Ω–ª–∞–π–Ω)');
                document.getElementById('online-count').textContent = '1';
                
                // –õ–æ–∫–∞–ª—å–Ω–∞—è –∏–≥—Ä–∞ —Å –ò–ò
                gameState.color = 'white';
                gameState.players.white = gameState.username;
                gameState.players.black = 'ü§ñ –ë–µ–∑—É–º–Ω—ã–π –ò–ò';
                document.getElementById('white-name').textContent = gameState.username;
                document.getElementById('black-name').textContent = 'ü§ñ –ë–µ–∑—É–º–Ω—ã–π –ò–ò';
                gameState.room = 'local_madness';
                updateStatus();
                
                // –ò–ò –¥–µ–ª–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ —Ö–æ–¥—ã
                setInterval(() => {
                    if (gameState.room === 'local_madness' && 
                        gameState.turn === 'black' && 
                        gameState.color === 'white') {
                        
                        setTimeout(() => {
                            const pieces = [];
                            for (let i = 0; i < 8; i++) {
                                for (let j = 0; j < 8; j++) {
                                    if (gameState.board[i][j] && gameState.board[i][j][0] === 'b') {
                                        pieces.push({row: i, col: j});
                                    }
                                }
                            }
                            
                            if (pieces.length > 0) {
                                const randomPiece = pieces[Math.floor(Math.random() * pieces.length)];
                                const possibleMoves = [];
                                
                                for (let i = 0; i < 8; i++) {
                                    for (let j = 0; j < 8; j++) {
                                        const rowDiff = Math.abs(i - randomPiece.row);
                                        const colDiff = Math.abs(j - randomPiece.col);
                                        if (rowDiff <= 3 && colDiff <= 3) {
                                            possibleMoves.push({row: i, col: j});
                                        }
                                    }
                                }
                                
                                if (possibleMoves.length > 0) {
                                    const randomMove = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
                                    makeMove(randomPiece.row, randomPiece.col, randomMove.row, randomMove.col);
                                }
                            }
                        }, 1000);
                    }
                }, 2000);
            }
        }, 2000);
    </script>
</body>
</html>